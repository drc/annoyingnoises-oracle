---
import { actions } from "astro:actions";
import Layout from "@/components/Layout.astro";

const sounds = await Astro.callAction(actions.readSounds.listAll, {});
console.log(sounds);
---

<Layout title="Home">
	<div class="index-header">
		<h1>Home</h1>
		<a href="/upload" class="upload-button">Upload Sound</a>
	</div>

	<main>
		<h2>Pick a Sound</h2>
		<ul>
			{
				sounds?.data?.objects
					.filter((o) => o.size > 0)
					.map((sound) => (
						<li>
							<span>{sound.key.replace("dota/", "")}</span>
							<button class="play-button" data-src={"https://assets.explosivejuice.com/" + sound.key}>
								Play
							</button>
						</li>
					))
			}
		</ul>
	</main>
</Layout>

<script>
	const buttons = document.querySelectorAll(".play-button");
	const audio = new Audio();

	buttons.forEach((button) => {
		button.addEventListener("click", () => {
			const src = button.getAttribute("data-src");
			if (src) {
				audio.src = src;
				audio.play().catch((e) => console.error("Error playing sound:", e));
			}
		});
	});
</script>

<style>
	.index-header {
		position: relative;
		display: flex;
		justify-content: center;
		align-items: center;
		margin-bottom: 2rem;
		padding-bottom: 1rem;
		border-bottom: var(--dota-border);
	}

	.index-header h1 {
		margin: 0;
		font-size: 2.5rem;
		color: var(--dota-gold);
	}

	.upload-button {
		position: absolute;
		right: 0;
		background: var(--dota-dark-red);
		border: var(--dota-border);
		color: var(--dota-gold);
		padding: 0.5rem 1rem;
		text-decoration: none;
		font-size: 0.8rem;
		border-radius: 2px;
		transition: all 0.2s;
		text-transform: uppercase;
		letter-spacing: 1px;
	}

	.upload-button:hover {
		background: var(--dota-red);
		box-shadow: 0 0 10px rgba(187, 51, 34, 0.3);
	}

	ul {
		list-style: none;
		padding: 0;
	}

	li {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 0.75rem 1rem;
		margin-bottom: 0.5rem;
		background: rgba(255, 255, 255, 0.05);
		border-radius: 4px;
		border: 1px solid rgba(194, 169, 112, 0.1);
	}

	.play-button {
		background: #661100; /* dota-dark-red fallback */
		background: var(--dota-dark-red);
		border: 1px solid rgba(194, 169, 112, 0.3); /* dota-border fallback */
		border: var(--dota-border);
		color: #c2a970; /* dota-gold fallback */
		color: var(--dota-gold);
		padding: 0.4rem 0.8rem;
		cursor: pointer;
		font-family: inherit;
		font-size: 0.9rem;
		border-radius: 2px;
		transition: all 0.2s;
		text-transform: uppercase;
		letter-spacing: 1px;
	}

	.play-button:hover {
		background: #bb3322; /* dota-red fallback */
		background: var(--dota-red);
		box-shadow: 0 0 10px rgba(187, 51, 34, 0.3);
	}

	.play-button:active {
		transform: translateY(1px);
	}

	
</style>
